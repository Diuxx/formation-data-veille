generator client {
  provider = "prisma-client-js"
  output   = "../../src/database/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("PRISMA_DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model audit_logs {
  id        String          @id @default(dbgenerated("(uuid())")) @db.Char(36)
  userId    String?         @db.Char(36)
  action    String          @db.VarChar(255)
  details   String?         @db.LongText
  ipAddress String?         @db.VarChar(255)
  type      audit_logs_type
  createdAt DateTime        @default(now()) @db.DateTime(0)
  users     users?          @relation(fields: [userId], references: [id], onUpdate: Restrict, map: "fk_audit_user")

  @@index([userId], map: "idx_audit_userId")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model sessions {
  id        String   @id @default(dbgenerated("(uuid())")) @db.Char(36)
  userId    String   @db.Char(36)
  createdAt DateTime @default(now()) @db.DateTime(0)
  expiresAt DateTime @db.DateTime(0)
  userAgent String?  @db.VarChar(255)
  ipAddress String?  @db.VarChar(255)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_sessions_user")

  @@index([userId], map: "idx_sessions_userId")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tokens {
  id        String      @id @default(dbgenerated("(uuid())")) @db.Char(36)
  userId    String      @db.Char(36)
  type      tokens_type
  token     String      @unique(map: "token") @db.VarChar(255)
  createdAt DateTime    @default(now()) @db.DateTime(0)
  expiresAt DateTime    @db.DateTime(0)
  users     users       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tokens_user")

  @@index([token], map: "idx_tokens_token")
  @@index([userId], map: "idx_tokens_userId")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  id           String       @id @default(dbgenerated("(uuid())")) @db.Char(36)
  email        String       @unique(map: "email") @db.VarChar(255)
  passwordHash String       @db.VarChar(255)
  name         String?      @db.VarChar(255)
  role         users_role   @default(USER)
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now()) @db.DateTime(0)
  updatedAt    DateTime     @default(now()) @db.DateTime(0)
  deletedAt    DateTime?    @db.DateTime(0)
  audit_logs   audit_logs[]
  sessions     sessions[]
  tokens       tokens[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model stack_versions {
  id          String    @id @default(dbgenerated("(uuid())")) @db.Char(36)
  stackId     String    @db.Char(36)
  version     String    @db.VarChar(100)
  releaseDate DateTime? @db.Date
  icon        String?   @db.VarChar(500)
  isLts       Boolean   @default(false)
  notes       String?   @db.Text
  tags        String?   @db.Text
  createdAt   DateTime  @default(now()) @db.DateTime(0)
  updatedAt   DateTime  @default(now()) @db.DateTime(0)
  deletedAt   DateTime? @db.DateTime(0)
  stacks      stacks    @relation(fields: [stackId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_stack_versions_stack")

  @@unique([stackId, version], map: "uq_stack_version")
  @@index([releaseDate], map: "idx_stack_versions_releaseDate")
  @@index([stackId], map: "idx_stack_versions_stackId")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model stacks {
  id             String           @id @default(dbgenerated("(uuid())")) @db.Char(36)
  name           String           @unique(map: "name") @db.VarChar(255)
  description    String?          @db.Text
  icon           String?          @db.VarChar(500)
  createdAt      DateTime         @default(now()) @db.DateTime(0)
  updatedAt      DateTime         @default(now()) @db.DateTime(0)
  deletedAt      DateTime?        @db.DateTime(0)
  stack_versions stack_versions[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tool_types {
  id          String    @id @default(dbgenerated("(uuid())")) @db.Char(36)
  name        String    @unique(map: "name") @db.VarChar(120)
  description String?   @db.Text
  createdAt   DateTime  @default(now()) @db.DateTime(0)
  updatedAt   DateTime  @default(now()) @db.DateTime(0)
  deletedAt   DateTime? @db.DateTime(0)
  tools       tools[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tools {
  id          String     @id @default(dbgenerated("(uuid())")) @db.Char(36)
  toolTypeId  String     @db.Char(36)
  name        String     @db.VarChar(255)
  description String?    @db.Text
  icon        String?    @db.VarChar(500)
  url         String?    @db.VarChar(500)
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now()) @db.DateTime(0)
  updatedAt   DateTime   @default(now()) @db.DateTime(0)
  deletedAt   DateTime?  @db.DateTime(0)
  tool_types  tool_types @relation(fields: [toolTypeId], references: [id], onUpdate: Restrict, map: "fk_tools_tool_type")

  @@index([isActive], map: "idx_tools_isActive")
  @@index([toolTypeId], map: "idx_tools_toolTypeId")
}

enum audit_logs_type {
  USER
  SYSTEM
  CRON
  WEBHOOK
  API_INTERNAL
  API_EXTERNAL
  SCHEDULED_TASK
  ANONYMOUS
  ADMIN_OVERRIDE
}

enum users_role {
  USER
  ADMIN
  SYSTEM
}

enum tokens_type {
  AUTHENTICATION
  RESET_PASSWORD
  EMAIL_VERIFICATION
  API_KEY
}
